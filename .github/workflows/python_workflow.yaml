name: PR Review Automation

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  pr_monitoring:
    runs-on: ubuntu-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.9

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run tests (Pytest)
      run: |
        pytest > result.log || true
        tail -n 10 result.log  # Display last 10 lines of test results

    - name: Calculate review time
      id: review_time
      run: |
        CHANGED_FILES=$(jq '.files | length' < $GITHUB_EVENT_PATH)
        REVIEW_TIME=$((CHANGED_FILES * 2))  # Assuming 2 minutes per file
        echo "Estimated review time: $REVIEW_TIME minutes"
        echo "::set-output name=review_time::$REVIEW_TIME"


    - name: Post PR comments
      run: |
        gh pr comment ${{ github.event.pull_request.number }} --body "Test results: PASS/FAIL. Most knowledgeable: ${{ steps.commit_info.outputs.most_expert }}. Estimated review time: ${{ steps.review_time.outputs.review_time }} minutes."
